<!DOCTYPE html>
<html lang="ko" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÎÇòÏóêÍ≤å ÎßûÎäî AI ÎèÑÍµ¨ Ï∞æÍ∏∞</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Pretendard Variable', ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
            background-color: #111827; /* Dark background */
            color: #E0E7FF; /* Light text */
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            overflow: hidden; /* Prevent scroll during transition */
        }

        .card-container {
            background-color: #0F172A; /* Darker card background */
            border-radius: 1rem;
            padding: 2rem;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            width: 100%;
            max-width: 42rem; /* max-w-2xl */
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            transition: opacity 0.3s ease-out, transform 0.3s ease-out; /* For step transition */
        }

        /* Focus ring for accessibility */
        *:focus-visible {
            outline: 2px solid #6366F1; /* Indigo-500 */
            outline-offset: 2px;
            border-radius: 0.5rem;
        }

        .btn-option {
            background-color: #1F2937; /* Gray-800 */
            border: 2px solid #374151; /* Gray-700 */
            color: #F9FAFB; /* White */
            transition: background-color 0.2s ease, border-color 0.2s ease, transform 0.1s ease;
        }

        .btn-option:hover {
            background-color: #374151; /* Gray-700 */
            border-color: #6366F1; /* Indigo-500 */
        }

        .btn-option:active {
            transform: scale(0.98);
        }

        .btn-option.selected {
            background-color: #4338CA; /* Indigo-700 */
            border-color: #6366F1; /* Indigo-500 */
            color: #E0E7FF; /* Light text */
        }

        .btn-cta {
            background-color: #6366F1; /* Indigo-500 */
            color: white;
            transition: background-color 0.2s ease, transform 0.1s ease;
        }

        .btn-cta:hover {
            background-color: #4F46E5; /* Indigo-600 */
        }

        .btn-cta:active {
            transform: scale(0.98);
        }

        .progress-bar {
            height: 0.5rem;
            background-color: #4F46E5; /* Indigo-600 */
            transition: width 0.3s ease-in-out;
            border-radius: 9999px; /* Full rounded */
        }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #6366F1;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
            .card-container {
                transition: none !important;
            }
            .progress-bar {
                transition: none !important;
            }
            .spinner {
                animation: none !important;
            }
        }
    </style>
</head>
<body>
    <!-- Accessibility: Aria live region for screen readers -->
    <div aria-live="polite" class="sr-only" id="aria-announcer"></div>

    <!-- Progress Bar -->
    <div class="fixed top-0 left-0 w-full bg-gray-800 z-10">
        <div id="progress-bar" class="progress-bar" style="width: 0%;"></div>
    </div>

    <!-- Main Quiz Container -->
    <div id="quiz-container" class="card-container">
        <!-- Content will be rendered here by JavaScript -->
    </div>

    <!-- Navigation/CTA Buttons Container -->
    <div id="nav-buttons-container" class="mt-8 flex gap-4">
        <!-- Buttons will be rendered here by JavaScript -->
    </div>

    <script>
        // SECTION: Data Definitions
        // ---------------------------------------------------------------------
        const toolCatalog = {
            wrtn: {
                name: "Wrtn (Î§ºÌäº)",
                emoji: "‚úçÔ∏è",
                desc: "ÌïúÍµ≠Ïñ¥Ïóê ÌäπÌôîÎêú AI Í∏ÄÏì∞Í∏∞ ÎèÑÍµ¨ÏûÖÎãàÎã§. Î∏îÎ°úÍ∑∏, Ïπ¥ÌîºÎùºÏù¥ÌåÖ Îì±Ïóê ÏµúÏ†ÅÌôîÎêòÏñ¥ ÏûàÏäµÎãàÎã§.",
                tags: ["Í∏ÄÏì∞Í∏∞", "ÌïúÍµ≠Ïñ¥", "Î¨¥Î£å"],
                url: "https://wrtn.ai/"
            },
            chatgpt_plus: {
                name: "ChatGPT Plus",
                emoji: "ü§ñ",
                desc: "Ïò§ÌîàAIÏùò ÏµúÏã† Î™®Îç∏ÏùÑ ÏÇ¨Ïö©ÌïòÎäî Î≤îÏö© Í≥†ÏÑ±Îä• AI ÎπÑÏÑúÏûÖÎãàÎã§. Îã§ÏñëÌïú ÏûëÏóÖÏóê ÌôúÏö© Í∞ÄÎä•Ìï©ÎãàÎã§.",
                tags: ["Î≤îÏö©", "Ï±óÎ¥á", "ÏÉùÏÇ∞ÏÑ±", "Ïú†Î£å"],
                url: "https://chat.openai.com/"
            },
            bing_image: {
                name: "Bing Image Creator",
                emoji: "üé®",
                desc: "Microsoft CopilotÏóê ÎÇ¥Ïû•Îêú Î¨¥Î£å Ïù¥ÎØ∏ÏßÄ ÏÉùÏÑ± ÎèÑÍµ¨ÏûÖÎãàÎã§. ÏâΩÍ≤å Ïù¥ÎØ∏ÏßÄÎ•º ÎßåÎì§ Ïàò ÏûàÏäµÎãàÎã§.",
                tags: ["Ïù¥ÎØ∏ÏßÄ ÏÉùÏÑ±", "Î¨¥Î£å", "Ïâ¨ÏõÄ"],
                url: "https://www.bing.com/images/create"
            },
            midjourney: {
                name: "Midjourney",
                emoji: "üñºÔ∏è",
                desc: "ÏòàÏà†Ï†ÅÏù¥Í≥† Í≥†ÌÄÑÎ¶¨Ìã∞Ïùò Ïù¥ÎØ∏ÏßÄÎ•º ÏÉùÏÑ±ÌïòÎäî Îç∞ Í∞ïÏ†êÏù¥ ÏûàÎäî AI ÎèÑÍµ¨ÏûÖÎãàÎã§. Ïú†Î£å Íµ¨ÎèÖ Í∏∞Î∞òÏûÖÎãàÎã§.",
                tags: ["Ïù¥ÎØ∏ÏßÄ ÏÉùÏÑ±", "ÏòàÏà†", "Í≥†ÌíàÏßà", "Ïú†Î£å"],
                url: "https://www.midjourney.com/"
            },
            cursor: {
                name: "Cursor",
                emoji: "üë®‚Äçüíª",
                desc: "Í∞úÎ∞úÏûêÎ•º ÏúÑÌïú AI Í∏∞Î∞ò ÏΩîÎìú ÏóêÎîîÌÑ∞ÏûÖÎãàÎã§. ÏΩîÎìú ÏûëÏÑ±, ÎîîÎ≤ÑÍπÖ, Î¨∏ÏÑúÌôî Îì±ÏùÑ ÎèïÏäµÎãàÎã§.",
                tags: ["ÏΩîÎî©", "Í∞úÎ∞ú", "ÏÉùÏÇ∞ÏÑ±", "ÏóêÎîîÌÑ∞"],
                url: "https://cursor.sh/"
            },
            claude: {
                name: "Claude",
                emoji: "üìö",
                desc: "AnthropicÏóêÏÑú Í∞úÎ∞úÌïú AI Ï±óÎ¥áÏúºÎ°ú, Í∏¥ Î¨∏Îß•ÏùÑ Ïù¥Ìï¥ÌïòÍ≥† ÏöîÏïΩÌïòÎäî Îç∞ ÌÉÅÏõîÌï©ÎãàÎã§.",
                tags: ["Ï±óÎ¥á", "ÏöîÏïΩ", "Í∏¥ Í∏Ä", "ÏÉùÏÇ∞ÏÑ±"],
                url: "https://claude.ai/"
            },
            gamma: {
                name: "Gamma",
                emoji: "üìä",
                desc: "ÌÖçÏä§Ìä∏ ÏûÖÎ†•ÎßåÏúºÎ°ú Î∞úÌëú ÏûêÎ£å, Î¨∏ÏÑú, ÏõπÌéòÏù¥ÏßÄÎ•º ÏûêÎèôÏúºÎ°ú ÏÉùÏÑ±Ìï¥Ï£ºÎäî ÎèÑÍµ¨ÏûÖÎãàÎã§.",
                tags: ["Î∞úÌëúÏûêÎ£å", "Î¨∏ÏÑú", "ÏÉùÏÇ∞ÏÑ±", "ÎîîÏûêÏù∏"],
                url: "https://gamma.app/"
            },
            zapier: {
                name: "Zapier",
                emoji: "üîó",
                desc: "Îã§ÏñëÌïú Ïõπ Ïï±ÏùÑ Ïó∞Í≤∞ÌïòÏó¨ ÏûëÏóÖÏùÑ ÏûêÎèôÌôîÌï¥Ï£ºÎäî ÌîåÎû´ÌèºÏûÖÎãàÎã§. ÏΩîÎî© ÏóÜÏù¥ ÏõåÌÅ¨ÌîåÎ°úÏö∞Î•º Íµ¨Ï∂ïÌï† Ïàò ÏûàÏäµÎãàÎã§.",
                tags: ["ÏûêÎèôÌôî", "Ïó∞Îèô", "ÏÉùÏÇ∞ÏÑ±", "ÏõåÌÅ¨ÌîåÎ°úÏö∞"],
                url: "https://zapier.com/"
            },
            make: {
                name: "Make",
                emoji: "‚öôÔ∏è",
                desc: "ZapierÏôÄ Ïú†ÏÇ¨ÌïòÍ≤å Ïï± Í∞ÑÏùò Ïó∞Í≤∞Í≥º ÏûêÎèôÌôîÎ•º Ï†úÍ≥µÌï©ÎãàÎã§. ÏãúÍ∞ÅÏ†ÅÏù∏ ÏõåÌÅ¨ÌîåÎ°úÏö∞ ÎπåÎçîÎ•º ÌäπÏßïÏúºÎ°ú Ìï©ÎãàÎã§.",
                tags: ["ÏûêÎèôÌôî", "Ïó∞Îèô", "ÏÉùÏÇ∞ÏÑ±", "ÏõåÌÅ¨ÌîåÎ°úÏö∞"],
                url: "https://www.make.com/"
            }
        };

        const recommendationLogic = {
            "quick:text:free": { tools: ["wrtn"], reason: "ÌïúÍµ≠Ïñ¥Ïóê Í∞ïÌïú Î¨¥Î£åÍ∏â Í∏ÄÏì∞Í∏∞ ÎèÑÍµ¨ÏûÖÎãàÎã§." },
            "quick:text:paid": { tools: ["chatgpt_plus"], reason: "Î≤îÏö©ÏÑ± ÎÜíÏùÄ Í≥†ÏÑ±Îä• AI ÎπÑÏÑúÏûÖÎãàÎã§." },
            "quick:image:free": { tools: ["bing_image"], reason: "Î¨¥Î£å Ïù¥ÎØ∏ÏßÄ ÏÉùÏÑ± ÏûÖÎ¨∏Ïö©ÏúºÎ°ú Ï¢ãÏäµÎãàÎã§." },
            "quick:image:paid": { tools: ["midjourney"], reason: "ÏòàÏà†Ï†Å ÌÄÑÎ¶¨Ìã∞Ïóê Í∞ïÏ†êÏù¥ ÏûàÏäµÎãàÎã§." },
            "deep:writing:marketing_kr": { tools: ["wrtn"], reason: "Î∏îÎ°úÍ∑∏, Ïπ¥ÌîºÎùºÏù¥ÌåÖ Îì± ÎßàÏºÄÌåÖ Í∏ÄÏì∞Í∏∞Ïóê ÏµúÏ†ÅÌôîÎêòÏñ¥ ÏûàÏäµÎãàÎã§." },
            "deep:writing:coding": { tools: ["cursor"], reason: "Í∞úÎ∞úÏûêÎ•º ÏúÑÌïú Í∞ïÎ†•Ìïú AI ÏΩîÎî© ÏóêÎîîÌÑ∞ÏûÖÎãàÎã§." },
            "deep:writing:paper": { tools: ["claude"], reason: "Í∏¥ Î¨∏Îß•Ïùò ÏöîÏïΩ Î∞è Ï†ïÎ¶¨Ïóê Í∞ïÏ†êÏù¥ ÏûàÏäµÎãàÎã§." },
            "deep:image:ppt": { tools: ["gamma"], reason: "ÌÖçÏä§Ìä∏ Í∏∞Î∞òÏúºÎ°ú Îπ†Î•¥Í≤å Î∞úÌëúÏûêÎ£åÎ•º ÏÉùÏÑ±Ìï† Ïàò ÏûàÏäµÎãàÎã§." },
            "deep:image:photo_art": { tools: ["midjourney"], reason: "Ïã§ÏÇ¨ Î∞è ÏòàÏà†Ï†ÅÏù∏ Í≥†ÌÄÑÎ¶¨Ìã∞ Ïù¥ÎØ∏ÏßÄÎ•º ÏÉùÏÑ±Ìï©ÎãàÎã§." },
            "deep:image:logo": { tools: ["bing_image"], reason: "Í∞ÑÎã®Ìïú Î°úÍ≥†/ÏïÑÏù¥ÏΩò ÏÉùÏÑ±Ïóê ÌôúÏö©ÌïòÍ∏∞ Ï¢ãÏäµÎãàÎã§." }, // Added based on Deep Dive flow
            "deep:productivity:automation": { tools: ["zapier", "make"], reason: "Îã§ÏñëÌïú Ïï± Ïó∞Í≤∞Í≥º ÏõåÌÅ¨ÌîåÎ°úÏö∞ ÏûêÎèôÌôîÎ•º ÏúÑÌïú ÎèÑÍµ¨ÏûÖÎãàÎã§." },
            "deep:productivity:docs": { tools: ["gamma"], reason: "Î¨∏ÏÑú Î∞è Ï†ïÎ¶¨ ÏûëÏóÖÏùò Ìö®Ïú®ÏÑ±ÏùÑ ÎÜíÏó¨Ï§çÎãàÎã§." }, // Added based on Deep Dive flow
            "deep:productivity:meeting": { tools: ["claude"], reason: "ÌöåÏùòÎ°ù ÏöîÏïΩ Î∞è Ï†ïÎ≥¥ Ï†ïÎ¶¨Ïóê Ïú†Ïö©Ìï©ÎãàÎã§." }, // Added based on Deep Dive flow
            // Fallback (if no specific match)
            "fallback": { tools: ["chatgpt_plus"], reason: "Î≤îÏö©ÏÑ±Ïù¥ ÎÜíÏùÄ Ï∂îÏ≤úÏûÖÎãàÎã§.", highlightTags: ["Î≤îÏö©", "Îã§Î™©Ï†Å"] }
        };

        // SECTION: State Management
        // ---------------------------------------------------------------------
        const defaultState = {
            mode: null,                 // "quick" | "deep"
            stepIndex: 0,               // Current step index
            answers: {},                // e.g., { domain:"text", price:"free", ... }
            history: [],                // { stepIndex, answersSnapshot }
        };

        let state = JSON.parse(localStorage.getItem('wizardState')) || { ...defaultState };
        // If state is loaded, but stepIndex is at result, reset for a fresh start or if mode is null.
        if (state.stepIndex >= steps.length || state.mode === null) {
            state = { ...defaultState };
        }

        const saveState = () => {
            localStorage.setItem('wizardState', JSON.stringify(state));
        };

        // SECTION: Step Definitions
        // ---------------------------------------------------------------------
        const steps = [
            // Step 0: Mode Selection
            {
                id: "mode_selection",
                title: "ÎÇòÏóêÍ≤å ÎßûÎäî AI ÎèÑÍµ¨ Ï∞æÍ∏∞",
                subtitle: "Ïñ¥Îñ§ Î∞©ÏãùÏúºÎ°ú Ï∂îÏ≤úÏùÑ Î∞õÍ≥† Ïã∂ÏúºÏã†Í∞ÄÏöî?",
                mode: "common",
                progressGroup: "mode",
                getOptions: () => [
                    { value: "quick", label: "‚ö° Í∞ÑÎã® Î™®Îìú" },
                    { value: "deep", label: "üßê Ïã¨Ìôî Î™®Îìú" }
                ],
                onSelect: (value) => {
                    state.mode = value;
                    state.answers = {}; // Reset answers on mode selection
                },
                next: () => {
                    const nextStepId = state.mode === "quick" ? "quick_task_type" : "deep_field_of_work";
                    return steps.findIndex(s => s.id === nextStepId);
                }
            },
            // Quick Mode Steps
            {
                id: "quick_task_type",
                title: "Ïñ¥Îñ§ ÏûëÏóÖÏùÑ ÌïòÏãúÎÇòÏöî?",
                subtitle: "Ï£ºÎ°ú Ïñ¥Îñ§ Ï¢ÖÎ•òÏùò AI ÎèÑÍµ¨Í∞Ä ÌïÑÏöîÌïòÏã†Í∞ÄÏöî?",
                mode: "quick",
                progressGroup: "quick_q1",
                getOptions: () => [
                    { value: "text", label: "ÌÖçÏä§Ìä∏ (Í∏ÄÏì∞Í∏∞, ÏöîÏïΩ, Î≤àÏó≠ Îì±)" },
                    { value: "image", label: "Ïù¥ÎØ∏ÏßÄ (ÏÉùÏÑ±, Ìé∏Ïßë, ÌôïÎåÄ Îì±)" },
                    { value: "video", label: "ÏòÅÏÉÅ (Ìé∏Ïßë, ÏÉùÏÑ±, ÏûêÎßâ Îì±)" },
                    { value: "other", label: "Í∏∞ÌÉÄ (Ïò§ÎîîÏò§, Îç∞Ïù¥ÌÑ∞ Î∂ÑÏÑù Îì±)" }
                ],
                onSelect: (value) => { state.answers.domain = value; },
                next: () => steps.findIndex(s => s.id === "quick_payment_pref")
            },
            {
                id: "quick_payment_pref",
                title: "Ïú†Î£å Í≤∞Ï†úÎèÑ Í¥úÏ∞ÆÎÇòÏöî?",
                subtitle: "ÏòàÏÇ∞Ïóê ÎßûÏ∂∞ AI ÎèÑÍµ¨Î•º Ï∂îÏ≤úÌï¥ ÎìúÎ¶¥Í≤åÏöî.",
                mode: "quick",
                progressGroup: "quick_q2",
                getOptions: () => [
                    { value: "free", label: "Î¨¥Î£åÎßå ÌïÑÏöîÌï¥Ïöî" },
                    { value: "paid", label: "Ïú†Î£åÎèÑ Í¥úÏ∞ÆÏïÑÏöî" }
                ],
                onSelect: (value) => { state.answers.price = value; },
                next: () => steps.findIndex(s => s.id === "result_quick")
            },
            // Deep Dive Mode Steps
            {
                id: "deep_field_of_work",
                title: "Í∞ÄÏû• ÌïÑÏöîÌïú ÏûëÏóÖ Î∂ÑÏïºÎäî?",
                subtitle: "Ï£ºÎ°ú Ïñ¥Îñ§ Î∂ÑÏïºÏóêÏÑú AIÏùò ÎèÑÏõÄÏùÑ Î∞õÍ≥† Ïã∂ÏúºÏã†Í∞ÄÏöî?",
                mode: "deep",
                progressGroup: "deep_q1",
                getOptions: () => [
                    { value: "writing", label: "Í∏ÄÏì∞Í∏∞ (ÏûëÎ¨∏, Î≤àÏó≠, ÏöîÏïΩ)" },
                    { value: "image", label: "Ïù¥ÎØ∏ÏßÄ (ÏÉùÏÑ±, Ìé∏Ïßë, Î∂ÑÏÑù)" },
                    { value: "productivity", label: "ÏóÖÎ¨¥ Ìö®Ïú® (ÏûêÎèôÌôî, Î¨∏ÏÑúÌôî, ÌöåÏùò)" }
                ],
                onSelect: (value) => { state.answers.domain = value; },
                next: () => {
                    switch (state.answers.domain) {
                        case "writing": return steps.findIndex(s => s.id === "deep_writing_sub_type");
                        case "image": return steps.findIndex(s => s.id === "deep_image_style");
                        case "productivity": return steps.findIndex(s => s.id === "deep_productivity_need");
                        default: return -1; // Should not happen
                    }
                }
            },
            {
                id: "deep_writing_sub_type",
                title: "Íµ¨Ï≤¥Ï†ÅÏúºÎ°ú Î¨¥ÏóáÏùÑ Ïì∞ÏãúÎÇòÏöî?",
                subtitle: "Ïñ¥Îñ§ Ï¢ÖÎ•òÏùò Í∏ÄÏì∞Í∏∞ ÏûëÏóÖÏóê AIÍ∞Ä ÌïÑÏöîÌïòÏã†Í∞ÄÏöî?",
                mode: "deep",
                progressGroup: "deep_q2a",
                getOptions: () => [
                    { value: "marketing_kr", label: "ÎßàÏºÄÌåÖ/Î∏îÎ°úÍ∑∏ (ÌïúÍµ≠Ïñ¥)" },
                    { value: "coding", label: "ÏΩîÎî©/Í∞úÎ∞ú" },
                    { value: "paper", label: "ÎÖºÎ¨∏/Í∏¥ Í∏Ä ÏöîÏïΩ" }
                ],
                onSelect: (value) => { state.answers.sub = value; },
                next: () => steps.findIndex(s => s.id === "deep_usage_style")
            },
            {
                id: "deep_image_style",
                title: "Ïñ¥Îñ§ Ïä§ÌÉÄÏùºÏùÑ ÏõêÌïòÏÑ∏Ïöî?",
                subtitle: "AI Ïù¥ÎØ∏ÏßÄ ÏÉùÏÑ± Ïãú Ïñ¥Îñ§ Í≤∞Í≥ºÎ¨ºÏùÑ ÏÑ†Ìò∏ÌïòÏãúÎÇòÏöî?",
                mode: "deep",
                progressGroup: "deep_q2b",
                getOptions: () => [
                    { value: "photo_art", label: "Ïã§ÏÇ¨/ÏòàÏà† (Í≥†ÌÄÑÎ¶¨Ìã∞)" },
                    { value: "ppt", label: "PPT/Î∞úÌëúÏûêÎ£å" },
                    { value: "logo", label: "Î°úÍ≥†/ÏïÑÏù¥ÏΩò" }
                ],
                onSelect: (value) => { state.answers.sub = value; },
                next: () => steps.findIndex(s => s.id === "deep_usage_style")
            },
            {
                id: "deep_productivity_need",
                title: "Ïñ¥Îñ§ ÎèÑÏõÄÏù¥ Í∞ÄÏû• ÌïÑÏöîÌïòÏã†Í∞ÄÏöî?",
                subtitle: "AIÎ•º ÌÜµÌï¥ Ïñ¥Îñ§ ÏóÖÎ¨¥ Ìö®Ïú®ÏùÑ ÎÜíÏù¥Í≥† Ïã∂ÏúºÏã†Í∞ÄÏöî?",
                mode: "deep",
                progressGroup: "deep_q2c",
                getOptions: () => [
                    { value: "automation", label: "ÏûêÎèôÌôî/Ïó∞Îèô" },
                    { value: "docs", label: "Î¨∏ÏÑú/Ï†ïÎ¶¨" },
                    { value: "meeting", label: "ÌöåÏùò/ÏöîÏïΩ" }
                ],
                onSelect: (value) => { state.answers.sub = value; },
                next: () => steps.findIndex(s => s.id === "deep_usage_style")
            },
            {
                id: "deep_usage_style",
                title: "ÏÑ†Ìò∏ÌïòÎäî ÏÇ¨Ïö© Î∞©ÏãùÏùÄ?",
                subtitle: "AI ÎèÑÍµ¨Î•º Ïñ¥ÎñªÍ≤å ÌôúÏö©ÌïòÍ≥† Ïã∂ÏúºÏã†Í∞ÄÏöî?",
                mode: "deep",
                progressGroup: "deep_q3",
                getOptions: () => [
                    { value: "simple", label: "Í∞ÑÎã®/Ï¶âÏãú ÏÇ¨Ïö© (ÏßÅÍ¥ÄÏ†ÅÏù∏ UI)" },
                    { value: "power", label: "Í∏∞Îä•/ÏÑ∏ÌåÖ Îã§Ïñë (ÏÑ∏Î∞ÄÌïú Ï†úÏñ¥)" }
                ],
                onSelect: (value) => { state.answers.style = value; },
                next: () => steps.findIndex(s => s.id === "result_deep")
            },
            // Result Steps
            {
                id: "result_quick",
                title: "AI ÎèÑÍµ¨ Ï∂îÏ≤ú Í≤∞Í≥º",
                subtitle: "ÎãπÏã†ÏóêÍ≤å Îî± ÎßûÎäî AI ÎèÑÍµ¨Î•º Ï∞æÏïòÏäµÎãàÎã§!",
                mode: "quick",
                progressGroup: "result",
                isResult: true
            },
            {
                id: "result_deep",
                title: "AI ÎèÑÍµ¨ Ï∂îÏ≤ú Í≤∞Í≥º",
                subtitle: "ÎãπÏã†ÏóêÍ≤å Îî± ÎßûÎäî AI ÎèÑÍµ¨Î•º Ï∞æÏïòÏäµÎãàÎã§!",
                mode: "deep",
                progressGroup: "result",
                isResult: true
            }
        ];

        // SECTION: Core Rendering & Logic
        // ---------------------------------------------------------------------
        const quizContainer = document.getElementById("quiz-container");
        const navButtonsContainer = document.getElementById("nav-buttons-container");
        const progressBar = document.getElementById("progress-bar");
        const ariaAnnouncer = document.getElementById("aria-announcer");

        // Helper to check if reduced motion is preferred
        const prefersReducedMotion = window.matchMedia("(prefers-reduced-motion: reduce)").matches;

        /**
         * Calculates the progress percentage based on the current step.
         * For Deep Dive, it considers the current branch's max steps.
         */
        const calculateProgress = () => {
            const currentStep = steps[state.stepIndex];
            if (!currentStep || currentStep.mode === "common") return 0; // No progress for mode selection

            const relevantSteps = steps.filter(s => s.mode === state.mode && s.progressGroup !== "mode");
            let totalProgressGroups = new Set();
            let completedProgressGroups = new Set();

            for (let i = 0; i < relevantSteps.length; i++) {
                const step = relevantSteps[i];
                if (step.progressGroup) {
                    totalProgressGroups.add(step.progressGroup);
                }

                if (i < state.stepIndex && step.mode === state.mode) {
                    completedProgressGroups.add(step.progressGroup);
                }
            }

            // For deep dive, we need to be more precise about the actual path
            if (state.mode === "deep") {
                const deepStepsOrder = [
                    "deep_field_of_work",
                    state.answers.domain === "writing" ? "deep_writing_sub_type" :
                    state.answers.domain === "image" ? "deep_image_style" :
                    state.answers.domain === "productivity" ? "deep_productivity_need" : null,
                    "deep_usage_style",
                    "result_deep"
                ].filter(Boolean); // Filter out nulls

                const currentStepId = steps[state.stepIndex].id;
                const currentActualIndex = deepStepsOrder.indexOf(currentStepId);
                if (currentActualIndex === -1) return 0; // Not a deep dive question or mode selection

                const totalActualSteps = deepStepsOrder.length;
                return Math.min(100, Math.round(((currentActualIndex + 1) / totalActualSteps) * 100));

            } else if (state.mode === "quick") {
                const quickStepsOrder = ["quick_task_type", "quick_payment_pref", "result_quick"];
                const currentStepId = steps[state.stepIndex].id;
                const currentActualIndex = quickStepsOrder.indexOf(currentStepId);
                if (currentActualIndex === -1) return 0;

                const totalActualSteps = quickStepsOrder.length;
                return Math.min(100, Math.round(((currentActualIndex + 1) / totalActualSteps) * 100));
            }
            return 0;
        };


        /**
         * Renders the current step's UI.
         */
        const renderStep = async () => {
            console.log("Current state:", JSON.stringify(state));
            const currentStep = steps[state.stepIndex];
            if (!currentStep) {
                console.error("Invalid step index:", state.stepIndex);
                return;
            }
            console.log("Current step ID:", currentStep.id);

            // Announce new question for screen readers
            ariaAnnouncer.textContent = `${currentStep.title}. ${currentStep.subtitle || ''}`;

            // Update progress bar
            progressBar.style.width = `${calculateProgress()}%`;

            // Apply fade-out animation if not reduced motion
            if (!prefersReducedMotion && quizContainer.innerHTML !== "") { // Don't animate on first load
                quizContainer.style.opacity = "0";
                quizContainer.style.transform = "translateY(20px)";
                await new Promise(resolve => setTimeout(resolve, 300)); // Wait for fade out
            }

            quizContainer.innerHTML = ''; // Clear previous content
            navButtonsContainer.innerHTML = ''; // Clear navigation buttons

            let contentHTML = `
                <h2 class="text-3xl font-extrabold mb-4 text-white">${currentStep.title}</h2>
                ${currentStep.subtitle ? `<p class="text-gray-400 mb-8 text-lg">${currentStep.subtitle}</p>` : ''}
            `;

            if (currentStep.isResult) {
                showLoadingScreen();
                // Simulate loading delay
                await new Promise(resolve => setTimeout(resolve, 1500));
                quizContainer.innerHTML = ''; // Clear loading screen
                contentHTML += renderResultCards();
            } else {
                const options = currentStep.getOptions ? currentStep.getOptions(state) : [];
                contentHTML += `
                    <div class="grid gap-4 w-full ${options.length > 2 ? 'md:grid-cols-2' : ''}">
                        ${options.map(option => `
                            <button
                                class="btn-option p-4 rounded-lg flex items-center justify-center text-lg font-semibold h-full
                                    ${state.answers[currentStep.id.includes('quick_') ? 'domain' : (currentStep.id.includes('deep_field') ? 'domain' : (currentStep.id.includes('deep_') && currentStep.id.includes('style') ? 'style' : 'sub'))] === option.value ? 'selected' : ''}"
                                data-action="select"
                                data-value="${option.value}"
                                data-step-index="${state.stepIndex}"
                                aria-pressed="${state.answers[currentStep.id.includes('quick_') ? 'domain' : (currentStep.id.includes('deep_field') ? 'domain' : (currentStep.id.includes('deep_') && currentStep.id.includes('style') ? 'style' : 'sub'))] === option.value}"
                            >
                                ${option.emoji ? `<span class="mr-2">${option.emoji}</span>` : ''}
                                <span>${option.label}</span>
                            </button>
                        `).join('')}
                    </div>
                `;
            }

            quizContainer.innerHTML = contentHTML;

            // Apply fade-in animation
            if (!prefersReducedMotion) {
                quizContainer.style.opacity = "0"; // Ensure it's hidden before setting transform
                quizContainer.style.transform = "translateY(-20px)";
                // Force reflow
                quizContainer.offsetHeight;
                quizContainer.style.opacity = "1";
                quizContainer.style.transform = "translateY(0)";
            } else {
                quizContainer.style.opacity = "1"; // Just show if no animation
                quizContainer.style.transform = "translateY(0)";
            }


            // Render navigation or CTA buttons
            renderNavButtons(currentStep);

            // Set initial focus for accessibility
            setTimeout(() => {
                const firstInteractiveElement = quizContainer.querySelector('button, a, input');
                if (firstInteractiveElement) {
                    firstInteractiveElement.focus();
                }
            }, prefersReducedMotion ? 0 : 300); // Wait for transition to end
        };

        const showLoadingScreen = () => {
            quizContainer.innerHTML = `
                <div class="flex flex-col items-center justify-center py-16">
                    <div class="spinner mb-6"></div>
                    <p class="text-xl text-gray-300">üîç AIÍ∞Ä ÎãπÏã†Ïùò ÎãµÎ≥ÄÏùÑ Î∂ÑÏÑù Ï§ëÏûÖÎãàÎã§...</p>
                </div>
            `;
        };

        const renderResultCards = () => {
            const currentStep = steps[state.stepIndex];
            const keyPrefix = state.mode;
            const domain = state.answers.domain;
            const sub = state.answers.sub;
            const price = state.answers.price;
            const style = state.answers.style; // for deep mode

            let recommendationKey;
            if (state.mode === "quick") {
                recommendationKey = `${keyPrefix}:${domain}:${price}`;
            } else { // deep mode
                recommendationKey = `${keyPrefix}:${domain}:${sub}`;
                // Future extension for 'style' if it changes the recommendation key directly
                // if (style) { recommendationKey += `:${style}`; }
            }

            let recommendation = recommendationLogic[recommendationKey] || recommendationLogic["fallback"];
            // If the deep mode answer for style exists, add its tags to the recommendation tags.
            // This is for display purpose, not changing the recommendation itself as per instructions.
            if (state.mode === "deep" && style) {
                // For simplicity, we just add a "simple" or "power" tag
                if (!recommendation.highlightTags) recommendation.highlightTags = [];
                recommendation.highlightTags.push(style === "simple" ? "Í∞ÑÌé∏Ìï®" : "Í∞ïÎ†•Ìï®");
            }


            const toolsToRecommend = recommendation.tools.slice(0, 2); // Max 2 cards
            let resultHtml = `
                <div class="w-full space-y-6">
                    ${toolsToRecommend.map(toolKey => {
                        const tool = toolCatalog[toolKey];
                        if (!tool) return '';
                        const allTags = new Set([...tool.tags, ...(recommendation.highlightTags || [])]);
                        const tagsHtml = Array.from(allTags).slice(0, 4).map(tag => `
                            <span class="bg-indigo-900/50 text-indigo-300 text-xs font-semibold px-2.5 py-0.5 rounded-full mr-2 mb-2">${tag}</span>
                        `).join('');

                        return `
                            <div class="bg-gray-800 p-6 rounded-lg text-left">
                                <div class="flex items-center mb-4">
                                    <span class="text-4xl mr-4">${tool.emoji}</span>
                                    <div>
                                        <h3 class="text-2xl font-bold text-white">${tool.name}</h3>
                                        <p class="text-gray-400 text-sm">${recommendation.reason}</p>
                                    </div>
                                </div>
                                <p class="text-gray-300 mb-4">${tool.desc}</p>
                                <div class="flex flex-wrap items-center">
                                    ${tagsHtml}
                                </div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
            return resultHtml;
        };

        const renderNavButtons = (currentStep) => {
            navButtonsContainer.innerHTML = '';
            if (currentStep.isResult) {
                const firstRecommendedTool = recommendationLogic[state.mode === "quick" ? `quick:${state.answers.domain}:${state.answers.price}` : `deep:${state.answers.domain}:${state.answers.sub}`]?.tools?.[0];
                const toolUrl = firstRecommendedTool ? toolCatalog[firstRecommendedTool]?.url : null;

                if (toolUrl) {
                    navButtonsContainer.innerHTML += `
                        <button class="btn-cta py-3 px-6 rounded-lg text-lg font-semibold" data-action="open_tool_link" data-url="${toolUrl}">
                            üåê ÏÇ¨Ïù¥Ìä∏ Î∞îÎ°úÍ∞ÄÍ∏∞
                        </button>
                    `;
                }
                navButtonsContainer.innerHTML += `
                    <button class="btn-option py-3 px-6 rounded-lg text-lg font-semibold" data-action="reset_wizard">
                        üîÑ Ï≤òÏùåÎ∂ÄÌÑ∞ Îã§Ïãú ÌïòÍ∏∞
                    </button>
                    <button class="btn-option py-3 px-6 rounded-lg text-lg font-semibold" data-action="go_to_home">
                        üè† ÌôàÏúºÎ°ú ÎèåÏïÑÍ∞ÄÍ∏∞
                    </button>
                `;
            } else {
                if (state.history.length > 0) {
                    navButtonsContainer.innerHTML += `
                        <button class="btn-option py-3 px-6 rounded-lg text-lg font-semibold" data-action="prev_step">
                            ‚Üê Îí§Î°úÍ∞ÄÍ∏∞
                        </button>
                    `;
                }
                // No 'Next' button as per Typeform style (auto-advance)
            }
        };

        const nextStep = () => {
            const currentStep = steps[state.stepIndex];
            if (currentStep.next) {
                const nextIndex = currentStep.next(state);
                if (nextIndex !== -1) {
                    state.history.push({ stepIndex: state.stepIndex, answersSnapshot: { ...state.answers } }); // Save current state for back
                    state.stepIndex = nextIndex;
                    saveState();
                    renderStep();
                }
            }
        };

        const prevStep = () => {
            if (state.history.length > 0) {
                const previousState = state.history.pop();
                state.stepIndex = previousState.stepIndex;
                state.answers = previousState.answersSnapshot;
                saveState();
                renderStep();
            }
        };

        const selectAnswer = (value) => {
            const currentStep = steps[state.stepIndex];
            if (currentStep && currentStep.onSelect) {
                // If a new answer is selected on the same step, ensure history is clean or updated
                // for the current step before pushing a new history item.
                if (state.history.length > 0 && state.history[state.history.length - 1].stepIndex === state.stepIndex) {
                    state.history.pop(); // Remove history entry if re-selecting on same step
                }
                currentStep.onSelect(value, state);
                saveState();
                nextStep(); // Auto-advance
            }
        };

        const resetWizard = () => {
            state = { ...defaultState };
            saveState();
            renderStep();
        };

        const goToHome = () => {
            // This is a placeholder as `index.html` is outside the wizard context.
            // In a real scenario, this would navigate to the actual home page.
            alert("ÌôàÏúºÎ°ú ÎèåÏïÑÍ∞ëÎãàÎã§. (ÌòÑÏû¨Îäî index.htmlÎ°ú Ïù¥Îèô ÎåÄÏã† ÏïåÎ¶ºÏúºÎ°ú ÎåÄÏ≤¥)");
            // window.location.href = 'index.html'; // Uncomment this in a full project
        };

        // SECTION: Event Listeners (Delegation)
        // ---------------------------------------------------------------------
        document.body.addEventListener("click", (event) => {
            const target = event.target.closest("[data-action]");
            if (!target) return;

            const action = target.dataset.action;
            switch (action) {
                case "select":
                    selectAnswer(target.dataset.value);
                    break;
                case "next_step": // Not used as we auto-advance
                    nextStep();
                    break;
                case "prev_step":
                    prevStep();
                    break;
                case "reset_wizard":
                    resetWizard();
                    break;
                case "go_to_home":
                    goToHome();
                    break;
                case "open_tool_link":
                    window.open(target.dataset.url, '_blank', 'noopener,noreferrer');
                    break;
            }
        });

        // Keyboard navigation
        document.body.addEventListener("keydown", (event) => {
            const currentStep = steps[state.stepIndex];
            if (currentStep.isResult) return;

            // Handle Enter/Space for buttons
            if (event.key === "Enter" || event.key === " ") {
                const focusedElement = document.activeElement;
                if (focusedElement && focusedElement.tagName === "BUTTON" && focusedElement.dataset.action === "select") {
                    focusedElement.click();
                    event.preventDefault(); // Prevent default scroll/space behavior
                } else if (focusedElement && focusedElement.tagName === "BUTTON" && (focusedElement.dataset.action === "prev_step" || focusedElement.dataset.action === "reset_wizard" || focusedElement.dataset.action === "go_to_home" || focusedElement.dataset.action === "open_tool_link")) {
                    focusedElement.click();
                    event.preventDefault();
                }
            }

            // Handle number keys 1-9 for selecting options
            if (event.key >= "1" && event.key <= "9") {
                const optionButtons = quizContainer.querySelectorAll(".btn-option[data-action='select']");
                const index = parseInt(event.key) - 1;
                if (index >= 0 && index < optionButtons.length) {
                    optionButtons[index].click();
                    event.preventDefault();
                }
            }
        });


        // SECTION: Initial Load
        // ---------------------------------------------------------------------
        document.addEventListener("DOMContentLoaded", renderStep);
    </script>
</body>
</html>
